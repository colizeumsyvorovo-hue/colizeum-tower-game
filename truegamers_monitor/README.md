# Telegram бот для мониторинга TrueGamers

Бот для автоматизации и мониторинга приложения TrueGamers на Android через Telegram.

## Возможности

- ✅ Автоматический вход в приложение
- ✅ Выбор клуба
- ✅ Открытие экрана с местами
- ✅ Автоматический мониторинг занятости мест
- ✅ Отправка скриншотов в Telegram

## Требования

1. **Python 3.8+**
2. **Android эмулятор** (Android Studio AVD, BlueStacks, Nox, и т.д.) или реальное устройство
3. **ADB (Android Debug Bridge)** установлен и доступен в PATH
4. **Telegram Bot Token** (получите у @BotFather)

## Установка

1. Перейдите в папку проекта:
```bash
cd truegamers_monitor
```

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Создайте файл `.env`:

**Вариант 1 (Windows):**
```bash
python create_env.py
```

**Вариант 2 (Windows):**
```bash
create_env.bat
```

**Вариант 3 (Вручную):**
Создайте файл `.env` в папке проекта со следующим содержимым (в кодировке UTF-8):
```
TELEGRAM_BOT_TOKEN=
ADB_PATH=adb
DEVICE_ID=
```

4. Отредактируйте `.env` и укажите ваш Telegram Bot Token:
```
TELEGRAM_BOT_TOKEN=your_bot_token_here
```

⚠️ **Важно:** Файл `.env` должен быть в кодировке UTF-8! Если получаете ошибку `UnicodeDecodeError`, удалите старый `.env` и создайте новый через `create_env.py`.

5. Настройте координаты в `config.py` под ваше устройство/эмулятор

## Настройка Android эмулятора

### Вариант 1: Android Studio AVD (рекомендуется)

1. Установите **Android Studio** и **Android SDK**
2. Создайте виртуальное устройство (AVD):
   - Tools → Device Manager → Create Device
   - Выберите устройство и образ системы
   - Рекомендуется: Android 8.0+ с разрешением 1080x1920 или выше
3. Запустите эмулятор
4. USB отладка включена по умолчанию в эмуляторах
5. Проверьте подключение:
```bash
adb devices
```
Вы должны увидеть устройство с именем типа `emulator-5554`

### Вариант 2: BlueStacks

1. Установите **BlueStacks**
2. Включите **Режим разработчика**:
   - Настройки → О программе → Нажмите 7 раз на "Номер сборки"
3. Включите **ADB отладку**:
   - Настройки → Расширенные → ADB отладка
4. Узнайте порт ADB (обычно 5555):
   - Настройки → Расширенные → Порт ADB
5. Подключитесь к BlueStacks:
```bash
adb connect 127.0.0.1:5555
```
6. Проверьте подключение:
```bash
adb devices
```

### Вариант 3: Nox Player

1. Установите **Nox Player**
2. Включите **Режим разработчика** и **USB отладку** (аналогично BlueStacks)
3. Подключитесь через ADB (порт обычно 62001):
```bash
adb connect 127.0.0.1:62001
```

### Вариант 4: Реальное устройство

1. Включите **Режим разработчика** на Android устройстве:
   - Перейдите в Настройки → О телефоне
   - Нажмите 7 раз на "Номер сборки"

2. Включите **USB отладку**:
   - Настройки → Для разработчиков → USB отладка

3. Подключите устройство к компьютеру через USB

4. Проверьте подключение:
```bash
adb devices
```

### Определение ID устройства

Если у вас несколько устройств/эмуляторов, укажите конкретный ID в `.env`:
```bash
# Посмотреть все подключенные устройства
adb devices

# Скопировать ID устройства (например: emulator-5554)
# И указать в .env: DEVICE_ID=emulator-5554
```

## Настройка координат

Важно настроить координаты экрана под ваш эмулятор/устройство в файле `config.py`.

Координаты зависят от разрешения экрана эмулятора. Например:
- **1080x1920** (Full HD) - стандартное разрешение
- **720x1280** (HD) - меньшее разрешение
- **1440x2560** (2K) - большее разрешение

### Определение координат:

1. Запустите бота и подключите эмулятор
2. Используйте команду `/check_device` - бот покажет размер экрана
3. Используйте команду `/open_places` - бот сделает скриншот
4. Откройте скриншот и определите координаты нужных элементов:
   - В Windows: можно использовать Paint (координаты внизу)
   - Или используйте инструменты для определения координат
5. Обновите `config.py` с правильными координатами

### Пример для разных разрешений:

**1080x1920 (Full HD):**
```python
LOGIN_COORDINATES = {
    'phone_input': (540, 800),   # Центр по X, ~40% по Y
    'password_input': (540, 900), # Центр по X, ~47% по Y
    'login_button': (540, 1000),  # Центр по X, ~52% по Y
}
```

**720x1280 (HD):**
```python
LOGIN_COORDINATES = {
    'phone_input': (360, 533),   # Пропорционально меньше
    'password_input': (360, 600),
    'login_button': (360, 667),
}
```

**Совет:** Используйте процентные значения от размера экрана для универсальности.

## Использование

1. Запустите бота:
```bash
python bot.py
```

2. В Telegram найдите вашего бота и отправьте `/start`

3. Доступные команды:
   - `/check_device` - Проверить подключение эмулятора/устройства
   - `/screenshot` - Сделать скриншот (для настройки координат)
   - `/login` - Войти в приложение (запросит телефон и пароль)
   - `/select_club` - Выбрать клуб
   - `/open_places` - Открыть экран с местами
   - `/monitor` - Начать автоматический мониторинг
   - `/stop_monitor` - Остановить мониторинг
   - `/status` - Статус системы
   - `/help` - Справка

## Структура проекта

```
truegamers_monitor/
├── bot.py                 # Основной файл бота
├── android_automation.py # Модуль автоматизации Android
├── config.py             # Конфигурация
├── requirements.txt      # Зависимости Python
├── .env.example          # Пример файла с переменными окружения
└── README.md             # Этот файл
```

## Важные замечания

⚠️ **Внимание:**
- Координаты экрана нужно настроить под конкретное устройство
- Приложение может изменить интерфейс, потребуется обновление координат
- Использование автоматизации может нарушать условия использования приложения
- Используйте на свой риск

## Решение проблем

### Устройство/эмулятор не подключается
- **Для эмулятора:** Убедитесь, что эмулятор запущен
- **Для BlueStacks/Nox:** Проверьте, что ADB отладка включена в настройках эмулятора
- **Для реального устройства:** Убедитесь, что USB отладка включена
- Попробуйте перезапустить ADB сервер:
  ```bash
  adb kill-server
  adb start-server
  adb devices
  ```
- **Для BlueStacks:** Если не подключается, попробуйте:
  ```bash
  adb connect 127.0.0.1:5555
  ```
- **Для Nox:** Попробуйте:
  ```bash
  adb connect 127.0.0.1:62001
  ```

### Координаты не работают
- Проверьте размер экрана устройства
- Используйте скриншоты для определения правильных координат
- Учитывайте разные разрешения экранов

### Бот не отвечает
- Проверьте правильность Bot Token
- Убедитесь, что бот запущен
- Проверьте логи на наличие ошибок

### Ошибка UnicodeDecodeError при запуске
- Удалите файл `.env` если он существует
- Создайте новый через `python create_env.py`
- Убедитесь, что файл сохранен в кодировке UTF-8
- Или используйте системные переменные окружения вместо `.env`

## Лицензия

Этот проект создан в образовательных целях.

